# Bridging Registrations
Bridging registrations to convert between different _Drosophila_ template brains. This is not intended as a complete list or all available to VFB but simply the registrations that are not currently publicly available elsewhere. Please use via the python ([navis](https://github.com/schlegelp/navis)) or R ([nat](https://natverse.org/)) resources below as they combine all available sources together.

## Ventral Nerve Cord (VNC)/Ventral Nervious System (VNS) template bridges

- JRC40xVNC2018U_JRCVNC2018U: JRC2018_VNC_Unisex_40x_DS -> JRC2018_VNC_UNISEX_4iso
- COURT2017VNS_JRCVNC2018F: DrosAdultVNSdomains_Court2017_template_Neuropil_LPS -> JRC2018_VNC_FEMALE_4iso_LPS
- COURT2018VNS_JRCVNC2018U: 20x_flyVNCtemplate_Female_symmetric -> JRC2018_VNC_UNISEX_4iso

Note: JRCVNC2018 bridging alignments are now available direct from Janelia: https://www.janelia.org/open-science/jrc-2018-brain-templates 

Details of the JRC[VNC]2018 templates are available here: https://www.janelia.org/open-science/jrc-2018-brain-templates 
  - JRCVNC2018U (660x1290x382 XYZ0.4)
  - JRCVNC2018F (660x1342x358 XYZ0.4)
  - JRCVNC2018M (659x1342x401 XYZ0.4)
  - JRC40xVNC2018U (573x1119x219 XY0.461122 Z0.7) 

Court2017 (512x1024x270 - XY0.4612588 Z0.46) was generated in http://hdl.handle.net/1842/25704 and was the original standard used in the preprint (https://www.biorxiv.org/content/10.1101/122952v1) 

Court2018 (512x1024x220 - XY0.4612588 Z0.7) was a symetrical version of Court2017 and was used as the original VNS template on [VFB](https://virtualflybrain.org/reports/VFB_00100000)

[VFB](https://VirtualFlyBrain.org) provides downloads of all templates it uses directly on the site.

Templates as well as painted domains are available in the [VirtualFlyBrain/DrosAdultVNSdomains](https://github.com/VirtualFlyBrain/DrosAdultVNSdomains) repo  

## [Navis](https://github.com/schlegelp/navis) (Python)
There registrations are loaded into [navis](https://github.com/schlegelp/navis) via the [navis-flybrains](https://github.com/navis-org/navis-flybrains) library.

### Installation
You can install `flybrains` from PyPI:

```bash
pip3 install flybrains
```

### External dependencies
In order to use the VFB transforms, you will need to have
[CMTK](https://www.nitrc.org/projects/cmtk/) installed.

For the FANC to JRCVNC2018F transform, you will need to download
[elastix](https://elastix.lumc.nl/index.php) and make sure that the path
to the binaries is in your `PATH` variable.

## Bridging transforms

<p align="center">
<img src="https://github.com/schlegelp/navis-flybrains/blob/main/_static/bridging_graph.png?raw=true" width="800">
</p>

It's highly recommended that after install, you download the optional
bridging transforms to map between template brains.

> :exclamation: If you already have downloaded these registrations via `nat.jrcbrains` and/or `nat.flybrains` you can skip this: `flybrains` should be able to find the registrations downloaded via R and register them for you (see also code at the bottom).

```Python
>>> import flybrains

# This downloads (or updates) various CMTK bridging and mirror transforms
# generated or collated by the Jefferis lab - see docstring for details
>>> flybrains.download_jefferislab_transforms()

# This downloads h5 bridging transforms generated by the Saalfeld lab (Janelia)
# - see docstring for details
>>> flybrains.download_saalfeldlab_transforms()

# This downloads (or updates) various CMTK bridging and mirror transforms
# generated or collated by VirtualFlyBrain.org - see docstring for details
>>> flybrains.download_vfb_transforms()

# Register the transforms - this is only necessary if you just downloaded them
>>> flybrains.register_transforms()
```

In the future, simply importing `flybrains` is sufficient to make the
transforms available to [navis](https://navis.readthedocs.io/en/latest/):

```Python
>>> import navis
>>> import flybrains
>>> import numpy as np
>>> points = np.array([[0, 0, 0]])
>>> navis.xform_brain(points, source='FAFB', target='JRC2018F')

```

On import of `flybrains`, these data sources are injected into and can be
readily used to e.g. transform 3d coordinates between brain spaces.
